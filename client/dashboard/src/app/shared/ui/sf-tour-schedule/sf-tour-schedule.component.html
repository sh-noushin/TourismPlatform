<section class="tour-schedule-section">
  <header class="schedule-header">
    <span class="label-text">{{ label() }}</span>
    @if (pendingCount() > 0) {
      <span class="pending-badge" title="{{ 'SCHEDULES.TOOLTIP' | translate }}">
        {{ pendingCount() }} {{ 'SCHEDULES.PENDING' | translate }}
      </span>
    }
    <button
      type="button"
      class="add-button"
      [disabled]="disabled() || disableAddButton()"
      (click)="toggleAddForm()"
    >
      {{ showAddForm() ? ('COMMON.CANCEL' | translate) : ('SCHEDULES.ADD_SCHEDULE' | translate) }}
    </button>
  </header>

  @if (showAddedMessage()) {
    <div class="success-message">{{ 'SCHEDULES.SCHEDULE_ADDED' | translate }}</div>
  }

  @if (showAddForm()) {
    <div class="add-form">
      <div class="form-row">
          <label class="form-field">
            <span class="field-label">{{ 'SCHEDULES.START_DATE_TIME' | translate }}</span>
          <input
            type="datetime-local"
            [ngModel]="newSchedule().startAtUtc"
            (ngModelChange)="updateNewScheduleField('startAtUtc', $event)"
            [disabled]="disabled()"
          />
        </label>
          <label class="form-field">
            <span class="field-label">{{ 'SCHEDULES.END_DATE_TIME' | translate }}</span>
          <input
            type="datetime-local"
            [ngModel]="newSchedule().endAtUtc"
            (ngModelChange)="updateNewScheduleField('endAtUtc', $event)"
            [disabled]="disabled()"
          />
        </label>
          <label class="form-field capacity">
            <span class="field-label">{{ 'SCHEDULES.CAPACITY' | translate }}</span>
          <input
            type="number"
            min="1"
            [ngModel]="newSchedule().capacity"
            (ngModelChange)="updateNewScheduleField('capacity', +$event)"
            [disabled]="disabled()"
          />
        </label>
      </div>
      <div class="form-actions">
        <button
          type="button"
          class="btn primary small"
          [disabled]="disabled() || disableAddButton()"
          (click)="addSchedule()"
        >
          {{ 'SCHEDULES.ADD' | translate }}
        </button>
      </div>
    </div>
  }

  @if (sortedSchedules().length > 0) {
    <div class="schedule-list">
      @for (schedule of sortedSchedules(); track trackSchedule($index, schedule); let i = $index) {
        <article class="schedule-item" [class.new]="schedule.isNew" [class.pending]="schedule.isNew">
          <div class="schedule-info">
            @if (schedule.isNew) {
              <span class="pending-indicator" title="{{ 'SCHEDULES.NOT_YET_SAVED' | translate }}">‚óè</span>
            }
            <div class="schedule-time">
              <span class="time-label">{{ 'SCHEDULES.START' | translate }}</span>
              <span class="time-value">{{ formatDateTime(schedule.startAtUtc) }}</span>
            </div>
            <div class="schedule-time">
              <span class="time-label">{{ 'SCHEDULES.END' | translate }}</span>
              <span class="time-value">{{ formatDateTime(schedule.endAtUtc) }}</span>
            </div>
            <div class="schedule-capacity">
              <span class="capacity-label">{{ 'SCHEDULES.CAPACITY' | translate }}</span>
              <span class="capacity-value">{{ schedule.capacity }}</span>
            </div>
          </div>
          <button
            type="button"
            class="text-button remove"
            [disabled]="disabled()"
            (click)="removeSchedule(i)"
          >
            {{ 'SCHEDULES.REMOVE' | translate }}
          </button>
        </article>
      }
    </div>
  } @else if (!showAddForm()) {
    <p class="no-schedules">{{ 'SCHEDULES.NO_SCHEDULES' | translate }}</p>
  }
</section>
