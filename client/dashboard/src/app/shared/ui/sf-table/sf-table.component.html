<div class="sf-table-wrapper">
  <div class="sf-table-scroll">
    <table>
      <thead>
        <tr>
          @for (column of columnsSignal(); track column.field ?? column.header ?? column) {
            <th [style.text-align]="column.align ?? 'left'" [style.width]="column.width">
              <button type="button" class="header-button" [class.sortable]="column.sortable" (click)="toggleSort(column)">
                {{ column.header }}
                @if (isSorting(column)) {
                  <span class="indicator">{{ sortSignal()?.direction === 'asc' ? '▲' : '▼' }}</span>
                }
              </button>
            </th>
          }
          @if (effectiveActions().length) {
            <th>Actions</th>
          }
        </tr>
      </thead>
      <tbody>
        @for (row of dataSignal(); track row.id ?? row) {
          <tr>
            @for (column of columnsSignal(); track column.field ?? column.header ?? column) {
              <td [style.text-align]="column.align ?? 'left'">{{ resolveValue(row, column.field) }}</td>
            }
            @if (effectiveActions().length) {
              <td class="actions-cell">
                @for (action of effectiveActions(); track action.type ?? $index) {
                  <sf-action
                    [label]="action.label"
                    [permission]="action.permission"
                    [icon]="actionIcon(action.type)"
                    [variant]="actionVariant(action.type)"
                    (actionClick)="emitRowAction(action, row)"
                  ></sf-action>
                }
              </td>
            }
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (!loadingSignal() && dataSignal().length === 0) {
    <div class="empty-state">
      <sf-empty-state title="Nothing to show" description="Try widening the filters"></sf-empty-state>
    </div>
  }

  @if (pagingSignal()) {
    <div class="footer">
      <button type="button" (click)="navigatePage('prev')" [disabled]="isFirstPage()">Previous</button>
      <span>Page {{ currentPage() }} of {{ totalPages() }}</span>
      <button type="button" (click)="navigatePage('next')" [disabled]="isLastPage()">Next</button>
    </div>
  }

  @if (loadingSignal()) {
    <div class="loading-overlay">
      <sf-spinner [size]="36"></sf-spinner>
    </div>
  }
</div>
