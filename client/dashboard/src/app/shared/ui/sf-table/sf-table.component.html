<div class="sf-table-wrapper">
  <div class="sf-table-scroll">
    <table>
      <thead>
        <tr>
          @for (column of columnsSignal(); track column.field ?? column.header ?? column) {
            <th
              [class.align-end]="column.align === 'end'"
              [style.text-align]="column.align ?? 'start'"
              [style.width]="column.width"
            >
              <button type="button" class="header-button" [class.sortable]="column.sortable" (click)="toggleSort(column)">
                {{ column.headerKey ? (column.headerKey | translate) : column.header }}
                @if (isSorting(column)) {
                  <span class="indicator">{{ sortSignal()?.direction === 'asc' ? '▲' : '▼' }}</span>
                }
              </button>
            </th>
          }
          @if (effectiveActions().length) {
            <th class="actions-header">{{ 'TABLE.ACTIONS' | translate }}</th>
          }
        </tr>
      </thead>
      <tbody>
        @for (row of dataSignal(); track row.id ?? row) {
          <tr>
            @for (column of columnsSignal(); track column.field ?? column.header ?? column) {
              <td [style.text-align]="column.align ?? 'start'">{{ resolveValue(row, column.field) }}</td>
            }
            @if (effectiveActions().length) {
              <td class="actions-cell">
                @for (action of effectiveActions(); track action.type ?? $index) {
                  <sf-action
                    [label]="action.labelKey ? (action.labelKey | translate) : action.label"
                    [permission]="action.permission"
                    [icon]="actionIcon(action.type)"
                    [variant]="actionVariant(action.type)"
                    (actionClick)="emitRowAction(action, row)"
                  ></sf-action>
                }
              </td>
            }
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (!loadingSignal() && dataSignal().length === 0) {
    <div class="empty-state">
      <sf-empty-state
        title="{{ 'COMMON.NOTHING_TO_SHOW' | translate }}"
        description="{{ 'COMMON.TRY_WIDENING_FILTERS' | translate }}"
      ></sf-empty-state>
    </div>
  }

  @if (pagingSignal()) {
    <div class="footer">
      <button type="button" (click)="navigatePage('prev')" [disabled]="isFirstPage()">
        {{ 'COMMON.PREVIOUS' | translate }}
      </button>
      <span
        >{{
          'COMMON.PAGE_INFO' | translate: { current: currentPage(), total: totalPages() }
        }}</span
      >
      <button type="button" (click)="navigatePage('next')" [disabled]="isLastPage()">
        {{ 'COMMON.NEXT' | translate }}
      </button>
    </div>
  }

  @if (loadingSignal()) {
    <div class="loading-overlay">
      <sf-spinner [size]="36"></sf-spinner>
    </div>
  }
</div>
