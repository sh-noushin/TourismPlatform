<section class="login-shell" (click)="langMenuOpen.set(false)">
  <div
    class="lang-selector"
    [class.open]="langMenuOpen()"
    [class.lang-selector--rtl]="langKey() === 'fa'"
  >
    <button type="button" class="lang-trigger" (click)="toggleLangMenu($event)">
      <span class="flag">
        @if (langKey() === 'fa') {
          <svg width="24" height="16" viewBox="0 0 24 16" aria-hidden="true">
            <rect width="24" height="5" fill="#239f40"></rect>
            <rect y="5" width="24" height="6" fill="#fff"></rect>
            <rect y="11" width="24" height="5" fill="#da0000"></rect>
          </svg>
        }
        @if (langKey() === 'en') {
          <svg width="24" height="16" viewBox="0 0 60 30" aria-hidden="true">
            <clipPath id="login_t"><path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/></clipPath>
            <path d="M0,0 v30 h60 v-30 z" fill="#00247d"/>
            <path d="M0,0 L60,30 M60,0 L0,30" stroke="#fff" stroke-width="6"/>
            <path d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#login_t)" stroke="#cf142b" stroke-width="4"/>
            <path d="M30,0 v30 M0,15 h60" stroke="#fff" stroke-width="10"/>
            <path d="M30,0 v30 M0,15 h60" stroke="#cf142b" stroke-width="6"/>
          </svg>
        }
      </span>

      <span class="lang-label">
        {{ langKey() === 'fa' ? ('LANG.FARSI' | translate) : ('LANG.ENGLISH' | translate) }}
      </span>

      <span class="chev" aria-hidden="true"></span>
    </button>

    @if (langMenuOpen()) {
      <div class="lang-menu" (click)="$event.stopPropagation()">
        <button type="button" class="lang-item" (click)="setLang('fa')" [class.selected]="langKey() === 'fa'">
          <span class="lang-item__flag">
            <svg width="24" height="16" viewBox="0 0 24 16" aria-hidden="true">
              <rect width="24" height="5" fill="#239f40"></rect>
              <rect y="5" width="24" height="6" fill="#fff"></rect>
              <rect y="11" width="24" height="5" fill="#da0000"></rect>
            </svg>
          </span>
          <span class="lang-item__label">{{ 'LANG.FARSI' | translate }}</span>
        </button>

        <button type="button" class="lang-item" (click)="setLang('en')" [class.selected]="langKey() === 'en'">
          <span class="lang-item__flag">
            <svg width="24" height="16" viewBox="0 0 60 30" aria-hidden="true">
              <clipPath id="login_t2"><path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/></clipPath>
              <path d="M0,0 v30 h60 v-30 z" fill="#00247d"/>
              <path d="M0,0 L60,30 M60,0 L0,30" stroke="#fff" stroke-width="6"/>
              <path d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#login_t2)" stroke="#cf142b" stroke-width="4"/>
              <path d="M30,0 v30 M0,15 h60" stroke="#fff" stroke-width="10"/>
              <path d="M30,0 v30 M0,15 h60" stroke="#cf142b" stroke-width="6"/>
            </svg>
          </span>
          <span class="lang-item__label">{{ 'LANG.ENGLISH' | translate }}</span>
        </button>
      </div>
    }
  </div>

  <div class="login-card">
    <div class="avatar" aria-hidden="true">
      <svg class="avatar__svg" viewBox="0 0 24 24" aria-hidden="true">
        <circle cx="12" cy="8" r="3.2"></circle>
        <path d="M4.5 20c1.8-4.2 13.2-4.2 15 0"></path>
      </svg>
    </div>

    <form class="login-form" (submit)="onSubmit($event)">
      <div class="field">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18">
            <path
              d="M12 12a4 4 0 1 0-4-4a4 4 0 0 0 4 4Zm0 2c-4.42 0-8 2-8 4.5V21h16v-2.5C20 16 16.42 14 12 14Z"
            />
          </svg>
        </span>

        <input
          type="email"
          name="username"
          autocomplete="username"
          placeholder="{{ 'LOGIN_PAGE.USERNAME_PLACEHOLDER' | translate }}"
          [value]="email()"
          (input)="email.set($any($event.target).value)"
          required
        />
      </div>

      <div class="field">
        <span class="icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="18" height="18">
            <path
              d="M17 9h-1V7a4 4 0 0 0-8 0v2H7a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2Zm-7-2a2 2 0 0 1 4 0v2h-4Z"
            />
          </svg>
        </span>

        <input
          type="password"
          name="password"
          autocomplete="current-password"
          placeholder="{{ 'LOGIN_PAGE.PASSWORD_PLACEHOLDER' | translate }}"
          [value]="password()"
          (input)="password.set($any($event.target).value)"
          required
        />
      </div>

      <div class="row">
        <a class="forgot" href="#" (click)="onForgot($event)">
          {{ 'LOGIN_PAGE.FORGOT_PASSWORD' | translate }}
        </a>
      </div>

      <sf-button
        class="login-btn"
        type="submit"
        [text]="'LOGIN_PAGE.SUBMIT' | translate"
        height="54px"
        width="100%"
        color="#7b8b9b"
        textColor="#ffffff"
        [loading]="loading()"
        [disabled]="!formValid() || loading()"
      ></sf-button>

      @if (error()) {
        <p class="error">{{ error() }}</p>
      }
    </form>
  </div>
</section>
