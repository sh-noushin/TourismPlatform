<div class="glass-panel" (click)="$event.stopPropagation()">
  <header class="tour-edit-header">
    <p class="eyebrow">
      {{ id ? ('TOUR_EDIT.EYEBROW_TOUR' | translate) : ('TOUR_EDIT.EYEBROW_NEW' | translate) }}
    </p>
    <h2>{{ id ? ('TOUR_EDIT.EDIT_TITLE' | translate) : ('TOUR_EDIT.NEW_TITLE' | translate) }}</h2>
    <p class="subtitle">
      {{ id ? ('TOUR_EDIT.SUBTITLE_EDIT' | translate) : ('TOUR_EDIT.SUBTITLE_CREATE' | translate) }}
    </p>
  </header>

  <div class="status-bar">
    @if (error()) {
      <span class="status error">{{ error() }}</span>
    }
    @if (saved()) {
      <span class="status success">{{ 'TOUR_EDIT.SAVED' | translate }}</span>
    }
  </div>

  @if (loadingSignal()) {
    <div class="tour-edit-loading">
      {{ 'TOUR_EDIT.LOADING_TOUR' | translate }}
    </div>
  } @else {
    @if (form(); as currentForm) {
      <form class="tour-edit-form" (submit)="save($event)">
        <section class="form-grid top">
          <label>
            <span class="label-text">{{ 'TOUR_EDIT.NAME' | translate }}</span>
            <input
              name="name"
              type="text"
              required
              placeholder="{{ 'TOUR_EDIT.NAME_PLACEHOLDER' | translate }}"
              [value]="currentForm.name"
              (input)="updateField('name', $any($event.target).value)"
            />
          </label>

          <label class="combobox">
            <span class="label-text">{{ 'TOUR_EDIT.CATEGORY' | translate }}</span>
            <sf-dropdown
              [items]="tourCategoryOptions()"
              [value]="currentForm.tourCategoryName"
              (selectionChange)="updateField('tourCategoryName', $event)"
              placeholder="{{ 'TOUR_EDIT.SELECT_CATEGORY' | translate }}"
              name="tourCategoryName"
            ></sf-dropdown>

            @if (tourCategories.loading()) {
              <p class="mini-note">{{ 'TOUR_EDIT.LOADING_CATEGORIES' | translate }}</p>
            }
            @if (tourCategories.error()) {
              <p class="status error">{{ tourCategories.error() }}</p>
            }
          </label>
        </section>

        <section class="form-grid description">
          <label>
            <span class="label-text">{{ 'TOUR_EDIT.DESCRIPTION' | translate }}</span>
            <textarea
              name="description"
              rows="3"
              placeholder="{{ 'TOUR_EDIT.DESCRIPTION_PLACEHOLDER' | translate }}"
              [value]="currentForm.description"
              (input)="updateField('description', $any($event.target).value)"
            ></textarea>
          </label>
        </section>

        <section class="schedule-section">
          <sf-tour-schedule
            [schedules]="currentForm.schedules"
            [disabled]="saving()"
            [disableAddButton]="!id"
            label="{{ 'TOUR_EDIT.TOUR_SCHEDULES' | translate }}"
            (schedulesChange)="onSchedulesChange($event)"
            (scheduleDeleted)="onScheduleDeleted($event)"
          ></sf-tour-schedule>

          @if (!id) {
            <p class="mini-note">{{ 'TOUR_EDIT.SCHEDULE_NOTE' | translate }}</p>
          }
        </section>

        <div class="fileupload-row">
          <sf-fileupload
            label="{{ 'TOUR_EDIT.PHOTOS' | translate }}"
            accept="image/*"
            [multiple]="true"
            [disabled]="uploading() || saving()"
            (filesSelected)="onFileSelected($event)"
          ></sf-fileupload>
        </div>

        @if (uploading()) {
          <p class="mini-note">{{ 'TOUR_EDIT.UPLOADING_FILES' | translate }}</p>
        }

        @if (currentForm.photos.length) {
          <div class="photos">
            <div class="photo-list">
              @for (photo of currentForm.photos; track trackPhoto($index, photo); let i = $index) {
                <article class="photo-item">
                  <div class="photo-thumb">
                    <img
                      [src]="photo.kind === 'existing' ? photo.url : photo.previewUrl"
                      [alt]="photo.label"
                      loading="lazy"
                    />
                  </div>

                  <div class="photo-info">
                    <span>{{ photo.label }}</span>
                  </div>

                  <button type="button" class="text-button" (click)="removePhoto(i)">
                    {{ 'TOUR_EDIT.REMOVE_PHOTO' | translate }}
                  </button>
                </article>
              }
            </div>
          </div>
        } @else {
          <p class="no-photos">{{ 'TOUR_EDIT.NO_PHOTOS' | translate }}</p>
        }

        <section class="actions">
          <button type="button" class="btn ghost" (click)="cancel()" [disabled]="saving()">
            {{ 'COMMON.CANCEL' | translate }}
          </button>
          <button type="submit" class="btn primary" [disabled]="saving()">
            {{ saving() ? ('COMMON.SAVING' | translate) : ('TOUR_EDIT.SAVE_TOUR' | translate) }}
          </button>
        </section>
      </form>
    } @else {
      <p class="tour-edit-placeholder">{{ 'COMMON.NO_DATA' | translate }}</p>
    }
  }
</div>
