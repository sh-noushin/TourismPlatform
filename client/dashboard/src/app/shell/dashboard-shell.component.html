<div
  class="shell"
  [class.shell--collapsed]="sidebarCollapsed()"
  (click)="closeUserMenu()"
>
  <aside
    class="sidebar"
    [class.sidebar--collapsed]="sidebarCollapsed()"
    (click)="$event.stopPropagation()"
  >
    <div class="sidebar__top">
      <button
        type="button"
        class="icon-btn"
        (click)="toggleSidebar()"
        aria-label="Toggle menu"
      >
        <span class="burger"></span>
      </button>
    </div>

    <nav class="nav">
      @for (item of menuItems; track item.basePath) {
        <div class="nav__group">
          <button
            type="button"
            class="nav__item"
            [class.nav__item--active]="isMenuActive(item)"
            (click)="openMenu(item)"
            [attr.aria-expanded]="item.subItems?.length ? expandedMenu() === item.basePath : null"
          >
            <span class="nav__icon" aria-hidden="true">{{ item.icon }}</span>

            @if (!sidebarCollapsed()) {
              <span class="nav__label">{{ item.label }}</span>
            }

            @if (!sidebarCollapsed() && item.subItems?.length) {
              <span class="nav__chev" [class.nav__chev--open]="expandedMenu() === item.basePath"></span>
            }
          </button>

          @if (!sidebarCollapsed() && item.subItems?.length && expandedMenu() === item.basePath) {
            <div class="nav__submenu">
              @for (sub of item.subItems; track sub.path) {
                <button
                  type="button"
                  class="nav__submenu-item"
                  [class.nav__submenu-item--active]="isSubMenuItemActive(sub)"
                  (click)="openSubMenuItem(item, sub)"
                >
                  {{ sub.label }}
                </button>
              }
            </div>
          }
        </div>
      }
    </nav>

    @if (!sidebarCollapsed()) {
      <div class="sidebar__brand">
        <div class="brand">
          <div class="brand__logo">TP</div>
          <div class="brand__text">
            <div class="brand__title">پلتفرم گردشگری</div>
          </div>
        </div>
      </div>
    }
  </aside>

  <div class="main">
    <div class="user-header" (click)="$event.stopPropagation()">
      <div class="user">
        <button type="button" class="user__btn" (click)="toggleUserMenu($event)">
          <span class="user__avatar">{{ initials() }}</span>
          <span class="user__name">{{ displayName() }}</span>
          <span class="user__chev"></span>
        </button>

        @if (userMenuOpen()) {
          <div class="user-menu" (click)="$event.stopPropagation()">
            <button type="button" class="user-menu__item" (click)="changePassword(); closeUserMenu()">
              Change password
            </button>
            <button type="button" class="user-menu__item danger" (click)="logout($event)">
              Logout
            </button>
          </div>
        }
      </div>
    </div>

    <section class="tabs">
      <div class="tabs__track">
        @for (tab of tabs.tabs(); track tab.id) {
          <button
            type="button"
            class="tab"
            [class.tab--active]="tabs.activeTabId() === tab.id"
            (click)="activate(tab)"
          >
            <span class="tab__title">{{ tab.title || 'Tab' }}</span>

            @if (!tab.pinned) {
              <span class="tab__close" (click)="close(tab, $event)" aria-hidden="true">x</span>
            }
          </button>
        }
      </div>
    </section>

    <main class="content">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>
